(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{6815:function(e,s,t){Promise.resolve().then(t.bind(t,7558))},7558:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Z}});var a=t(7437),r=t(2265),l=t(9376),n=t(8933),i=t(1723),d=t(3468),o=t(9801),c=t(2636),x=t(6901),m=t(3247),h=t(5863),b=t(2252),p=t(5800);function u(){let[e,s]=(0,r.useState)({pending:0,revising:0,fulfilled:0,total:0}),[t,l]=(0,r.useState)(!0),d=(0,n.e)();return((0,r.useEffect)(()=>{(async()=>{let e=async e=>{let{count:s}=await d.from("orders").select("*",{count:"exact",head:!0}).eq("status",e);return s||0},[t,a,r]=await Promise.all([e("pending"),e("revising"),e("fulfilled")]);s({pending:t,revising:a,fulfilled:r,total:t+a+r}),l(!1)})()},[d]),t)?(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-pulse",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"h-24 bg-white/50 rounded-xl"},s))}):(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsx)(v,{label:"Pending Review",value:e.pending,icon:i.Z,color:"text-brand-navy",bgColor:"bg-white",borderColor:"border-brand-navy/20",shadow:"shadow-sm"}),(0,a.jsx)(v,{label:"Revisions",value:e.revising,icon:c.Z,color:"text-rose-500",bgColor:"bg-white",borderColor:"border-rose-100",shadow:"shadow-sm"}),(0,a.jsx)(v,{label:"Fulfilled",value:e.fulfilled,icon:x.Z,color:"text-green-600",bgColor:"bg-white",borderColor:"border-green-100",shadow:"shadow-sm"}),(0,a.jsx)(v,{label:"Total Orders",value:e.total,icon:b.Z,color:"text-zinc-500",bgColor:"bg-white",borderColor:"border-zinc-200",shadow:"shadow-sm"})]})}function v(e){let{label:s,value:t,icon:r,color:l,bgColor:n,borderColor:i,shadow:d}=e;return(0,a.jsxs)(p.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"p-4 rounded-xl border ".concat(n," ").concat(i," ").concat(d," flex items-center gap-4"),children:[(0,a.jsx)("div",{className:"p-3 rounded-full bg-brand-bg/50 ".concat(l),children:(0,a.jsx)(r,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-2xl font-bold ".concat(l),children:t}),(0,a.jsx)("p",{className:"text-xs text-zinc-400 uppercase tracking-wider font-semibold",children:s})]})]})}var g=t(6424),f=t(2489),j=t(401),w=t(3145);function N(e){let{order:s,images:t,onApproveAll:r,onReviewImage:l,onExpand:n}=e,d=t.filter(e=>"pending_review"===e.status),o=d.length>0;return(0,a.jsx)(p.E.div,{layout:!0,className:"glass-card rounded-xl overflow-hidden transition-all hover:border-brand-blue/50 ".concat(o?"ring-2 ring-brand-navy/10":""),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 items-start",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-brand-navy",children:s.customer_name}),(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:s.customer_email})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-zinc-500",children:[(0,a.jsx)("span",{className:"text-zinc-700 font-medium",children:s.pet_name||"Pet Swap"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:(null==s?void 0:s.product_type)||"Unknown Product"}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{className:"text-zinc-400",children:(0,g.WU)(new Date(s.created_at),"MMM d, h:mm a")})]}),s.customer_notes&&(0,a.jsxs)("div",{className:"mt-3 flex items-start gap-2 text-brand-navy text-sm bg-brand-blue/30 p-3 rounded-lg border border-brand-blue/20",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mt-0.5 shrink-0"}),(0,a.jsx)("p",{className:"line-clamp-2",children:s.customer_notes})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-3 shrink-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:o?(0,a.jsxs)("span",{className:"px-3 py-1 rounded-full bg-brand-navy/10 text-brand-navy text-xs font-bold flex items-center gap-1.5 border border-brand-navy/20",children:[(0,a.jsx)(i.Z,{className:"w-3 h-3"}),"Needs Review (",d.length,")"]}):(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-bold border ".concat("fulfilled"===s.status?"bg-green-100 text-green-700 border-green-200":"bg-zinc-100 text-zinc-500 border-zinc-200"),children:s.status})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[o&&(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),r(s.id,d.map(e=>e.id))},className:"flex items-center gap-2 px-4 py-2 bg-brand-navy text-white font-bold rounded-lg hover:bg-brand-navy/90 transition-colors text-sm shadow-md shadow-brand-navy/20",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4"}),"Approve All"]}),(0,a.jsx)("button",{onClick:()=>n(s),className:"px-4 py-2 bg-white hover:bg-zinc-50 text-brand-navy border border-zinc-200 rounded-lg text-sm font-medium transition-colors",children:"Details"})]})]})]}),o&&(0,a.jsx)(p.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"mt-6 pt-6 border-t border-brand-blue/20",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[s.pet_image_url&&(0,a.jsxs)("div",{className:"relative aspect-[3/4] rounded-lg overflow-hidden border border-zinc-200 opacity-80 hover:opacity-100 transition-opacity",children:[(0,a.jsx)(w.default,{src:s.pet_image_url,alt:"Reference",fill:!0,className:"object-cover"}),(0,a.jsx)("div",{className:"absolute top-2 left-2 px-1.5 py-0.5 bg-black/60 text-white text-[10px] rounded font-medium",children:"Ref"})]}),d.slice(0,5).map(e=>(0,a.jsxs)("div",{className:"relative aspect-[3/4] rounded-lg overflow-hidden border border-zinc-200 group",children:[(0,a.jsx)(w.default,{src:e.url,alt:"Candidate",fill:!0,className:"object-cover"}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-brand-navy/20 backdrop-blur-[1px] opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>l(e.id,"rejected"),className:"p-2 rounded-full bg-white text-rose-500 hover:bg-rose-500 hover:text-white transition-colors shadow-sm",title:"Reject",children:(0,a.jsx)(f.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>l(e.id,"approved"),className:"p-2 rounded-full bg-white text-brand-navy hover:bg-brand-navy hover:text-white transition-colors shadow-sm",title:"Approve",children:(0,a.jsx)(j.Z,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"absolute bottom-0 inset-x-0 p-2 bg-white/90 backdrop-blur-sm border-t border-zinc-100",children:(0,a.jsx)("p",{className:"text-[10px] text-zinc-700 truncate",children:e.theme_name})})]},e.id)),d.length>5&&(0,a.jsxs)("button",{onClick:()=>n(s),className:"aspect-[3/4] rounded-lg bg-zinc-50 border border-zinc-200 flex flex-col items-center justify-center text-zinc-500 hover:text-brand-navy hover:bg-zinc-100 transition-colors",children:[(0,a.jsxs)("span",{className:"text-xl font-bold",children:["+",d.length-5]}),(0,a.jsx)("span",{className:"text-xs",children:"More"})]})]})})]})})}var y=t(7586),z=t(3113),_=t(6362);function k(e){let{order:s,images:t,isOpen:r,onClose:l,onReviewImage:n}=e,i=t.filter(e=>"pending_review"===e.status),d=t.filter(e=>"approved"===e.status),o=t.filter(e=>"rejected"===e.status);return(0,a.jsx)(y.M,{children:r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:"fixed inset-0 bg-brand-navy/40 backdrop-blur-sm z-50"}),(0,a.jsxs)(p.E.div,{initial:{x:"100%",opacity:.5},animate:{x:0,opacity:1},exit:{x:"100%",opacity:.5},transition:{type:"spring",damping:25,stiffness:200},className:"fixed inset-y-0 right-0 w-full max-w-2xl bg-white/95 backdrop-blur-md border-l border-zinc-200 z-50 flex flex-col shadow-2xl",children:[(0,a.jsxs)("div",{className:"p-6 border-b border-zinc-200 flex justify-between items-start bg-zinc-50/50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-brand-navy font-playfair",children:s.customer_name}),(0,a.jsxs)("div",{className:"flex gap-2 text-sm mt-1",children:[(0,a.jsx)("span",{className:"text-brand-navy/70 font-medium",children:s.product_type}),(0,a.jsx)("span",{className:"text-zinc-300",children:"•"}),(0,a.jsx)("span",{className:"text-zinc-500",children:s.pet_name})]})]}),(0,a.jsx)("button",{onClick:l,className:"p-2 rounded-full hover:bg-zinc-100 text-zinc-400 hover:text-brand-navy transition-colors",children:(0,a.jsx)(f.Z,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[s.customer_notes&&(0,a.jsxs)("div",{className:"bg-brand-blue/30 border border-brand-blue/20 rounded-xl p-4 flex gap-3",children:[(0,a.jsx)(b.Z,{className:"w-5 h-5 text-brand-navy shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-brand-navy font-bold text-sm mb-1",children:"Customer Notes"}),(0,a.jsx)("p",{className:"text-brand-navy/80 text-sm leading-relaxed",children:s.customer_notes})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-zinc-400 font-bold text-xs uppercase tracking-wider mb-3",children:"Reference Photo"}),s.pet_image_url?(0,a.jsx)("div",{className:"relative aspect-square w-48 rounded-xl overflow-hidden border border-zinc-200 shadow-sm",children:(0,a.jsx)(w.default,{src:s.pet_image_url,alt:"Pet Reference",fill:!0,className:"object-cover"})}):(0,a.jsx)("div",{className:"w-48 h-48 rounded-xl bg-zinc-50 flex items-center justify-center border border-zinc-200 text-zinc-400",children:(0,a.jsx)(z.Z,{className:"w-8 h-8 opacity-50"})})]}),i.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsxs)("h3",{className:"text-brand-navy font-bold text-xs uppercase tracking-wider flex items-center gap-2",children:["Needs Review",(0,a.jsx)("span",{className:"bg-brand-navy/10 px-2 py-0.5 rounded-full text-brand-navy",children:i.length})]})}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4",children:i.map(e=>(0,a.jsxs)("div",{className:"group relative aspect-[3/4] rounded-xl overflow-hidden border border-zinc-200 hover:border-brand-navy transition-colors shadow-sm",children:[(0,a.jsx)(w.default,{src:e.url,alt:"To Review",fill:!0,className:"object-cover"}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-brand-navy/30 backdrop-blur-[1px] group-hover:bg-brand-navy/50 transition-colors flex items-center justify-center gap-3 opacity-0 group-hover:opacity-100",children:[(0,a.jsx)("button",{onClick:()=>n(e.id,"rejected"),className:"p-3 bg-white text-rose-500 rounded-full shadow-lg hover:bg-rose-500 hover:text-white transition-all font-bold",title:"Reject",children:(0,a.jsx)(f.Z,{className:"w-5 h-5"})}),(0,a.jsx)("button",{onClick:()=>n(e.id,"approved"),className:"p-3 bg-white text-brand-navy rounded-full shadow-lg hover:bg-brand-navy hover:text-white transition-all font-bold",title:"Approve",children:(0,a.jsx)(j.Z,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"absolute bottom-0 inset-x-0 p-3 bg-white/90 backdrop-blur-md border-t border-white/20",children:(0,a.jsx)("span",{className:"text-brand-navy text-sm font-medium",children:e.theme_name})})]},e.id))})]}),d.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-green-600 font-bold text-xs uppercase tracking-wider mb-4 flex items-center gap-2",children:["Approved",(0,a.jsx)("span",{className:"bg-green-100 px-2 py-0.5 rounded-full text-green-700",children:d.length})]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3",children:d.map(e=>(0,a.jsxs)("div",{className:"relative aspect-[3/4] rounded-lg overflow-hidden border border-green-200 opacity-90 hover:opacity-100 transition-opacity",children:[(0,a.jsx)(w.default,{src:e.url,alt:"Approved",fill:!0,className:"object-cover"}),(0,a.jsx)("div",{className:"absolute top-2 right-2 p-1 bg-green-500 rounded-full text-white shadow-sm",children:(0,a.jsx)(j.Z,{className:"w-3 h-3"})})]},e.id))})]}),o.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-rose-500 font-bold text-xs uppercase tracking-wider mb-4 flex items-center gap-2",children:["Rejected",(0,a.jsx)("span",{className:"bg-rose-100 px-2 py-0.5 rounded-full text-rose-700",children:o.length})]}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-3",children:o.map(e=>(0,a.jsxs)("div",{className:"relative aspect-[3/4] rounded-lg overflow-hidden border border-rose-200 opacity-60 hover:opacity-100 transition-opacity grayscale hover:grayscale-0",children:[(0,a.jsx)(w.default,{src:e.url,alt:"Rejected",fill:!0,className:"object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(f.Z,{className:"w-8 h-8 text-rose-500 drop-shadow-sm"})})]},e.id))})]})]}),(0,a.jsxs)("div",{className:"p-6 border-t border-zinc-200 bg-zinc-50/50 flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:l,className:"px-4 py-2 text-zinc-500 hover:text-brand-navy transition-colors text-sm font-medium",children:"Close"}),(0,a.jsxs)("a",{href:"/admin/orders/".concat(s.id),className:"px-5 py-2 btn-primary rounded-lg text-sm font-bold flex items-center gap-2 transition-colors",children:["Full Order Details",(0,a.jsx)(_.Z,{className:"w-4 h-4"})]})]})]})]})})}var C=t(2645);function Z(){let e=(0,l.useRouter)(),s=(0,n.e)(),[t,b]=(0,r.useState)([]),[v,g]=(0,r.useState)({}),[f,j]=(0,r.useState)(!0),[w,y]=(0,r.useState)("needs_review"),[z,_]=(0,r.useState)(""),[Z,O]=(0,r.useState)(null);(0,r.useEffect)(()=>{S()},[w,z]);let S=async()=>{j(!0);try{let e=s.from("orders").select("*");"needs_review"===w?e=e.neq("status","fulfilled").neq("status","failed"):"inbox"===w?e=e.eq("status","pending"):"revising"===w?e=e.eq("status","revising"):"fulfilled"===w?e=e.eq("status","fulfilled"):"archived"===w?e=e.eq("status","failed"):"all"===w&&(e=e.neq("status","failed")),z&&(e=e.or("customer_name.ilike.%".concat(z,"%,customer_email.ilike.%").concat(z,"%,pet_name.ilike.%").concat(z,"%"))),e=e.order("created_at",{ascending:!1}).limit(50);let{data:t,error:a}=await e;if(a)throw a;let r=t||[],l=r.map(e=>e.id),n=[];if(l.length>0){let{data:e,error:t}=await s.from("images").select("*").in("order_id",l);if(t)throw t;n=e||[]}let i={};n.forEach(e=>{i[e.order_id]||(i[e.order_id]=[]),i[e.order_id].push(e)});let d=r;"needs_review"===w&&(d=r.filter(e=>(i[e.id]||[]).some(e=>"pending_review"===e.status))),b(d),g(i)}catch(e){console.error("Dashboard fetch error:",e)}finally{j(!1)}},E=async(e,s)=>{g(t=>{let a=[...t[e]||[]].map(e=>s.includes(e.id)?{...e,status:"approved"}:e);return{...t,[e]:a}}),await Promise.all(s.map(e=>fetch("/api/admin/review-queue",{method:"POST",body:JSON.stringify({imageId:e,status:"approved"})})))},q=async(e,s)=>{let t="";for(let[s,a]of Object.entries(v))if(a.find(s=>s.id===e)){t=s;break}t&&(g(a=>{let r=[...a[t]||[]].map(t=>t.id===e?{...t,status:s}:t);return{...a,[t]:r}}),await fetch("/api/admin/review-queue",{method:"POST",body:JSON.stringify({imageId:e,status:s})}))};return(0,a.jsxs)("div",{className:"min-h-screen px-4 py-8 max-w-7xl mx-auto space-y-8 pb-32",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-brand-navy font-playfair",children:"Command Center"}),(0,a.jsx)("p",{className:"text-zinc-500 mt-1",children:"Unified view of all orders and pending reviews"})]}),(0,a.jsx)("button",{onClick:()=>e.push("/admin/create"),className:"btn-primary flex items-center gap-2 shadow-lg shadow-brand-navy/20",children:"+ New Order"})]}),(0,a.jsx)("div",{className:"hidden md:block",children:(0,a.jsx)(u,{})}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 sticky top-4 z-30 bg-white/80 backdrop-blur-xl p-2 rounded-xl border border-brand-blue/30 shadow-xl shadow-brand-navy/5",children:[(0,a.jsxs)("div",{className:"flex p-1 bg-brand-bg border border-zinc-200 rounded-lg overflow-x-auto no-scrollbar",children:[(0,a.jsx)(R,{active:"needs_review"===w,onClick:()=>y("needs_review"),icon:i.Z,label:"Needs Review",highlight:!0}),(0,a.jsx)("div",{className:"w-px bg-zinc-300 mx-1 my-2"}),(0,a.jsx)(R,{active:"all"===w,onClick:()=>y("all"),icon:d.Z,label:"All active"}),(0,a.jsx)(R,{active:"inbox"===w,onClick:()=>y("inbox"),icon:o.Z,label:"Inbox"}),(0,a.jsx)(R,{active:"revising"===w,onClick:()=>y("revising"),icon:c.Z,label:"Revising"}),(0,a.jsx)(R,{active:"fulfilled"===w,onClick:()=>y("fulfilled"),icon:x.Z,label:"Fulfilled"}),(0,a.jsx)(R,{active:"archived"===w,onClick:()=>y("archived"),icon:o.Z,label:"Archived"})]}),(0,a.jsxs)("div",{className:"relative flex-1 group",children:[(0,a.jsx)(m.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-400 group-focus-within:text-brand-navy transition-colors"}),(0,a.jsx)("input",{type:"text",placeholder:"Search orders...",value:z,onChange:e=>_(e.target.value),className:"w-full h-full bg-white border border-zinc-200 rounded-lg pl-10 pr-4 text-sm text-brand-navy focus:ring-2 focus:ring-brand-blue/50 outline-none transition-all placeholder:text-zinc-400"})]})]}),(0,a.jsx)(C.S,{children:(0,a.jsx)(p.E.div,{layout:!0,className:"space-y-4",children:f?(0,a.jsx)("div",{className:"py-20 flex justify-center",children:(0,a.jsx)(h.Z,{className:"w-8 h-8 animate-spin text-brand-navy"})}):0===t.length?(0,a.jsxs)("div",{className:"py-20 text-center border-2 border-dashed border-zinc-200 rounded-2xl bg-white/50",children:[(0,a.jsx)("p",{className:"text-zinc-500 font-medium",children:"No orders found."}),"needs_review"===w&&(0,a.jsx)("p",{className:"text-sm text-zinc-400 mt-2",children:"Good job! You're all caught up."})]}):t.map(e=>(0,a.jsx)(N,{order:e,images:v[e.id]||[],onApproveAll:E,onReviewImage:q,onExpand:e=>O(e)},e.id))})}),Z&&(0,a.jsx)(k,{order:Z,images:v[Z.id]||[],isOpen:!!Z,onClose:()=>O(null),onReviewImage:q})]})}function R(e){let{active:s,onClick:t,icon:r,label:l,highlight:n}=e;return(0,a.jsxs)("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 rounded-md transition-all text-sm font-medium whitespace-nowrap\n        ".concat(s?n?"bg-brand-navy text-white shadow-md":"bg-white text-brand-navy shadow-sm":"text-zinc-500 hover:text-brand-navy hover:bg-zinc-200/50"),children:[(0,a.jsx)(r,{className:"w-4 h-4"}),l]})}},8933:function(e,s,t){"use strict";t.d(s,{O:function(){return a},e:function(){return r}});let a=(0,t(8439).eI)("https://opxgicxdrbpgpsxonogk.supabase.co","sb_publishable_oy3hhF4k8MiMOpfOBiCxOw_8nvsY8i2"),r=()=>a}},function(e){e.O(0,[799,145,439,424,536,971,117,744],function(){return e(e.s=6815)}),_N_E=e.O()}]);