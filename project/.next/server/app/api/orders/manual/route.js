"use strict";(()=>{var e={};e.id=1296,e.ids=[1296],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},84588:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>O,patchFetch:()=>h,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>S});var a={};t.r(a),t.d(a,{POST:()=>y});var s=t(49303),n=t(88716),o=t(60670),i=t(87070),u=t(92048),d=t.n(u),l=t(55315),c=t.n(l);let p=c().join(process.cwd(),"local-db.json");function m(){if(!d().existsSync(p)){let e={orders:[],images:[]};try{d().writeFileSync(p,JSON.stringify(e,null,2))}catch(e){console.error("Failed to init DB",e)}return e}try{return JSON.parse(d().readFileSync(p,"utf-8"))}catch(e){return console.error("Failed to read DB",e),{orders:[],images:[]}}}function g(e){d().writeFileSync(p,JSON.stringify(e,null,2))}let _={async insertOrder(e){let r=m(),t={id:crypto.randomUUID(),created_at:new Date().toISOString(),status:"pending",pet_name:null,order_number:`ORD-${Date.now()}`,customer_name:"Guest",customer_email:"guest@example.com",product_type:"royalty",payment_status:"paid",social_consent:!1,social_handle:null,marketing_consent:!1,consent_date:null,rating:null,review_text:null,revision_status:"none",revision_notes:null,access_token:null,selected_image_id:null,selected_print_product:null,customer_notes:null,bonus_unlocked:!1,bonus_payment_status:"unpaid",stripe_session_id:null,viewed_at:null,downloaded_count:0,bonus_conversion:!1,upsell_conversion:!1,share_count:0,...e};return r.orders.push(t),g(r),t},async insertImages(e){let r=m(),t=e.map(e=>({id:crypto.randomUUID(),created_at:new Date().toISOString(),status:"pending_review",watermarked_url:null,...e}));return r.images.push(...t),g(r),t},getImagesByStatus:async e=>m().images.filter(r=>r.status===e),async updateImageStatus(e,r){let t=m(),a=t.images.find(r=>r.id===e);a&&(a.status=r,g(t))},getImage:async e=>m().images.find(r=>r.id===e),getOrder:async e=>m().orders.find(r=>r.id===e),getOrders:async e=>m().orders.filter(r=>e.includes(r.id)),getImagesByOrderId:async e=>m().images.filter(r=>r.order_id===e),getPendingOrders:async()=>m().orders.filter(e=>"pending"===e.status),getAllOrders:async()=>m().orders.sort((e,r)=>new Date(r.created_at).getTime()-new Date(e.created_at).getTime()),async updateOrderStatus(e,r){let t=m(),a=t.orders.find(r=>r.id===e);a&&(a.status=r,g(t))}};async function y(e){try{let r=await e.formData(),t=r.get("customerName"),a=r.get("customerEmail"),s=r.get("productType")||"Manual Order",n=r.getAll("files"),o=r.getAll("mockups"),u=await _.insertOrder({customer_name:t,customer_email:a,product_type:s,status:"ready"}),l=c().join(process.cwd(),"public","uploads",u.id);d().existsSync(l)||d().mkdirSync(l,{recursive:!0});let p=async(e,r,t)=>{let a=Buffer.from(await e.arrayBuffer()),s=e.name.replace(/[^a-zA-Z0-9.-]/g,"_"),n=c().join(l,s);return d().writeFileSync(n,a),{order_id:u.id,url:`/uploads/${u.id}/${s}`,storage_path:`uploads/${u.id}/${s}`,type:r,status:"approved",display_order:t,is_selected:!1,is_bonus:!1}},m=await Promise.all(n.map((e,r)=>p(e,"primary",r))),g=await Promise.all(o.map((e,r)=>p(e,"mockup",r))),y=[...m,...g];return await _.insertImages(y),i.NextResponse.json({success:!0,orderId:u.id,customerUrl:`/customer/gallery/${u.id}`})}catch(e){return console.error("Manual order failed:",e),i.NextResponse.json({error:"Failed to create order"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/orders/manual/route",pathname:"/api/orders/manual",filename:"route",bundlePath:"app/api/orders/manual/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/orders/manual/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:S,serverHooks:v}=f,O="/api/orders/manual/route";function h(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:S})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972],()=>t(84588));module.exports=a})();