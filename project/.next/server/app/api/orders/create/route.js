"use strict";(()=>{var e={};e.id=9426,e.ids=[9426],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},8152:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>j,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>x});var s=t(49303),a=t(88716),i=t(60670),p=t(87070),n=t(94670),u=t(65655),c=t(20471),l=t(92048),d=t.n(l),m=t(55315),g=t.n(m);async function x(e){try{let r,t,o,s,a,i;let l=e.headers.get("content-type")||"",m=!1;if(l.includes("multipart/form-data")){let n=await e.formData();r=n.get("customerName"),t=n.get("customerEmail"),o=n.get("productType");let u=n.get("petPhoto");if(a=n.get("petBreed"),i=n.get("petDetails"),m="true"===n.get("autoApprove"),!r||!t||!o||!u)return p.NextResponse.json({error:"Missing required form fields: customerName, customerEmail, productType, petPhoto"},{status:400});if(u){let e=g().join(process.cwd(),"public","uploads","pets");d().existsSync(e)||d().mkdirSync(e,{recursive:!0});let r=Buffer.from(await u.arrayBuffer()),t=`pet-${Date.now()}-${u.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`;d().writeFileSync(g().join(e,t),r),s=`/uploads/pets/${t}`}else s="https://placeholder/dog.jpg"}else{let a=await e.json();r=a.customerName,t=a.customerEmail,o=a.productType,s=a.petPhotoUrl}let x=(0,u.i)(),{data:f,error:h}=await x.from("orders").insert({customer_name:r,customer_email:t,product_type:o,pet_image_url:s,status:"pending",pet_breed:a||null,pet_details:i||null}).select().single();if(h)throw console.error("DB Insert Error",h),Error(`Order creation failed: ${h.message}`);let y=f.id;return(0,c.l)(t,r,y,"ordered").catch(e=>console.error("Failed to send welcome email:",e)),(0,n.yU)(f.id,s,o,a,i,m).catch(e=>{console.error("Background Generation Failed:",e)}),p.NextResponse.json({success:!0,customerUrl:`/customer/gallery/${y}`})}catch(e){return console.error("Order creation failed:",e),p.NextResponse.json({error:e.message||"Internal server error"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/orders/create/route",pathname:"/api/orders/create",filename:"route",bundlePath:"app/api/orders/create/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/orders/create/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:q}=f,v="/api/orders/create/route";function j(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:y})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,2723,1258,4670],()=>t(8152));module.exports=o})();