"use strict";(()=>{var e={};e.id=798,e.ids=[798],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},26837:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>b,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{POST:()=>d});var s=t(49303),a=t(88716),n=t(60670),i=t(87070),p=t(44273),u=t(69498);async function d(e){let r;let t=await e.text(),o=e.headers.get("stripe-signature"),s=new p.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-12-15.clover"}),a=(0,u.eI)("https://opxgicxdrbpgpsxonogk.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);if(!o)return i.NextResponse.json({error:"No signature provided"},{status:400});try{r=s.webhooks.constructEvent(t,o,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return console.error("Webhook signature verification failed:",e),i.NextResponse.json({error:"Invalid signature"},{status:400})}try{switch(r.type){case"checkout.session.completed":{let e=r.data.object;if(e.metadata?.productType==="bonus_theme"){let r=e.metadata.orderId,{error:t}=await a.from("orders").update({bonus_unlocked:!0,bonus_payment_status:"paid",stripe_session_id:e.id}).eq("id",r);if(t)return console.error("Failed to update order:",t),i.NextResponse.json({error:"Failed to update order"},{status:500});console.log(`Bonus theme unlocked for order ${r}`)}break}case"checkout.session.expired":{let e=r.data.object;console.log(`Checkout session expired: ${e.id}`);break}case"payment_intent.succeeded":{let e=r.data.object;console.log(`Payment succeeded: ${e.id}`);break}case"payment_intent.payment_failed":{let e=r.data.object;console.log(`Payment failed: ${e.id}`);break}default:console.log(`Unhandled event type: ${r.type}`)}return i.NextResponse.json({received:!0})}catch(e){return console.error("Error processing webhook:",e),i.NextResponse.json({error:"Webhook processing failed"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/webhooks/stripe/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:x}=c,b="/api/webhooks/stripe/route";function m(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,4273],()=>t(26837));module.exports=o})();