"use strict";(()=>{var e={};e.id=724,e.ids=[724],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},41428:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>_,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var i={};t.r(i),t.d(i,{POST:()=>c});var o=t(49303),n=t(88716),a=t(60670),s=t(87070),d=t(65655);let l={canvas:{blueprint_id:1234,print_provider_id:29,variant_id:45678},bear:{blueprint_id:9999,print_provider_id:10,variant_id:88888},tumbler:{blueprint_id:68,print_provider_id:16,variant_id:13398},"canvas-11x14":{blueprint_id:1234,print_provider_id:29,variant_id:45678},digital:{blueprint_id:0,print_provider_id:0,variant_id:0}};class p{static{this.API_BASE="https://api.printify.com/v1"}static get SHOP_ID(){return process.env.PRINTIFY_SHOP_ID}static get TOKEN(){return process.env.PRINTIFY_API_TOKEN}static async createOrder(e){console.log(`[Printify] Preparing order for ${e.orderId} (${e.productType})`);let r=l[e.productType];if(!r||0===r.blueprint_id)return console.warn(`[Printify] Skipping: No valid printify config for ${e.productType}`),null;if(!this.TOKEN||!this.SHOP_ID)return console.log("⚠️ [Printify Mock Mode] API Token or Shop ID missing. Logging payload only."),console.log("Payload:",JSON.stringify(this.buildPayload(e,r),null,2)),"mock-print-id-"+Date.now();try{let t=await fetch(`${this.API_BASE}/shops/${this.SHOP_ID}/orders.json`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.TOKEN}`},body:JSON.stringify(this.buildPayload(e,r))});if(!t.ok){let e=await t.text();throw Error(`Printify API Error: ${t.status} ${e}`)}let i=await t.json();return console.log(`[Printify] Order Created Successfully! ID: ${i.id}`),i.id}catch(e){return console.error("[Printify] Failed to create order:",e),null}}static buildPayload(e,r){return{external_id:e.orderId,label:`Order ${e.orderId} - ${e.customerName}`,line_items:[{print_provider_id:r.print_provider_id,blueprint_id:r.blueprint_id,variant_id:r.variant_id,print_areas:{front:[{src:e.imageUrl}]},quantity:1}],shipping_method:1,send_shipping_notification:!0,address_to:{first_name:e.customerName.split(" ")[0]||"Customer",last_name:e.customerName.split(" ").slice(1).join(" ")||".",email:e.customerEmail,phone:"555-555-5555",country:"US",region:"CA",address1:"123 Main St",city:"Beverly Hills",zip:"90210",...e.shippingAddress}}}static async uploadImage(e){try{console.log(`[Printify] Uploading image: ${e}`);let r=await fetch(`${this.API_BASE}/uploads/images.json`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.TOKEN}`},body:JSON.stringify({url:e,file_name:"upload_"+Date.now()+".jpg"})});if(!r.ok)return console.error(`[Printify] Upload Failed: ${await r.text()}`),null;return(await r.json()).id}catch(e){return console.error("[Printify] Upload Error:",e),null}}static async generateMockupImage(e,r){if(!this.TOKEN||!this.SHOP_ID)return console.warn("[Printify] Missing API Token or Shop ID for mockup generation."),null;let t=l[r];(!t||t.blueprint_id<100)&&(console.log('[Printify] Using Fallback "Mug" Config for Testing (Real IDs)'),t={blueprint_id:68,print_provider_id:16,variant_id:13398}),console.log(`[Printify] Generating Mockup for ${r} using Blueprint: ${t.blueprint_id}`);try{let r=await this.uploadImage(e);if(!r)throw Error("Failed to upload image to Printify");let i={title:"Temp Mockup Product "+Date.now(),description:"Temporary product for mockup generation",blueprint_id:t.blueprint_id,print_provider_id:t.print_provider_id,variants:[{id:t.variant_id,price:1e3,is_enabled:!0}],print_areas:[{variant_ids:[t.variant_id],placeholders:[{position:"front",images:[{id:r,x:.5,y:.5,scale:1,angle:0}]}]}]},o=await fetch(`${this.API_BASE}/shops/${this.SHOP_ID}/products.json`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.TOKEN}`},body:JSON.stringify(i)});if(!o.ok){let e=await o.text();throw Error(`Create Product Failed: ${e}`)}let n=await o.json(),a=n.id;console.log(`[Printify] Temp Product Created: ${a}`);let s="";if(n.images&&n.images.length>0&&(s=(n.images.find(e=>e.is_default)||n.images[0]).src),!s){console.log("[Printify] No images in create response, fetching product details...");let e=await fetch(`${this.API_BASE}/shops/${this.SHOP_ID}/products/${a}.json`,{headers:{Authorization:`Bearer ${this.TOKEN}`}}),r=await e.json();r.images&&r.images.length>0&&(s=r.images[0].src)}return console.log(s?"[Printify] Found Mockup URL":"[Printify] Failed to find mockup URL"),await fetch(`${this.API_BASE}/shops/${this.SHOP_ID}/products/${a}.json`,{method:"DELETE",headers:{Authorization:`Bearer ${this.TOKEN}`}}),console.log("[Printify] Temp Product Deleted"),s||null}catch(e){return console.error("[Printify] Generate Mockup Failed:",e),null}}}async function c(e,{params:r}){try{let{orderId:t}=r;console.log(`[ConfirmAPI] Confiming order ${t} ...`);let i=await e.json();console.log("[ConfirmAPI] Body:",i),console.log("[ConfirmAPI] Social Data:",{consent:i.socialConsent,handle:i.socialHandle});let{selectedImageId:o,printProduct:n,notes:a,socialConsent:l,socialHandle:c}=i,u=(0,d.i)();if(!o||!n)return s.NextResponse.json({error:"Selected image and print product are required"},{status:400});let{error:_}=await u.from("orders").update({selected_image_id:o,selected_print_product:n,customer_notes:a||null,social_consent:l||!1,social_handle:c||null,status:"processing_print"}).eq("id",t);if(_)return console.error("DB Update Error:",_),s.NextResponse.json({error:"Failed to update order"},{status:500});let{data:m}=await u.from("orders").select("*, customer_email, customer_name").eq("id",t).single(),{data:g}=await u.from("images").select("url").eq("id",o).single();if(m&&g&&"digital"!==n){let e=await p.createOrder({orderId:t,customerEmail:m.customer_email,customerName:m.customer_name,imageUrl:g.url,productType:n,shippingAddress:m.shipping_address});e&&(console.log(`[Fulfillment] Started Printify Order: ${e}`),await u.from("orders").update({print_provider_order_id:e,fulfillment_status:"sent_to_printify"}).eq("id",t))}return s.NextResponse.json({success:!0})}catch(e){return console.error("Confirm selection error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/customer/[orderId]/confirm/route",pathname:"/api/customer/[orderId]/confirm",filename:"route",bundlePath:"app/api/customer/[orderId]/confirm/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/customer/[orderId]/confirm/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:_,staticGenerationAsyncStorage:m,serverHooks:g}=u,f="/api/customer/[orderId]/confirm/route";function h(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},65655:(e,r,t)=>{t.d(r,{i:()=>o});var i=t(69498);function o(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,i.eI)("https://opxgicxdrbpgpsxonogk.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1},global:{fetch:(e,r)=>fetch(e,{...r,cache:"no-store"})}})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[9276,5972,9498],()=>t(41428));module.exports=i})();