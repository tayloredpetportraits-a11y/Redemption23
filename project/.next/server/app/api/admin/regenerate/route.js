"use strict";(()=>{var e={};e.id=9057,e.ids=[9057],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},63432:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>x});var i={};t.r(i),t.d(i,{POST:()=>m});var a=t(49303),o=t(88716),n=t(60670),s=t(87070),p=t(65655),u=t(94670),d=t(55315),l=t.n(d),c=t(92048),g=t.n(c);async function m(e){try{let{imageId:r,promptOverride:t}=await e.json(),i=(0,p.i)(),{data:a,error:o}=await i.from("images").select("*, orders(pet_image_url, pet_breed, pet_details, id)").eq("id",r).single();if(o||!a)throw Error("Image not found");let n=a.orders;if(!n)throw Error("Order not found");let d=l().basename(a.url),c=d.match(/^(primary|upsell)_swap_(\d+)\.png$/);if(!c)throw Error("Could not parse image filename to identify template");let m=c[1],h=parseInt(c[2]),f=l().join(process.cwd(),"public","templates","primary"===m?"royalty":"valentines"),x=g().readdirSync(f).filter(e=>/\.(jpg|png|webp)$/i.test(e)).sort();if(h>=x.length)throw Error("Template index out of bounds");let y=l().join(f,x[h]),w=n.pet_image_url.startsWith("/")?n.pet_image_url.slice(1):n.pet_image_url,_=l().join(process.cwd(),"public",w),q=l().join(process.cwd(),"public","generated",n.id),b=l().join(q,d),j=t;!j&&(j="Image 1 is the Reference Pet. Image 2 is the Scene Template. action: Replace the subject in Image 2 with the dog from Image 1.",n.pet_breed&&(j+=` The dog is a ${n.pet_breed}.`),j+=" Recreate the scene from Image 2 exactly, but using the dog from Image 1. Maintain the lighting, style, and clothing of Image 2. Identity Lock: Mandatory.",n.pet_details&&(j+=` Verify features: ${n.pet_details}.`)),console.log(`[Regen] Regenerating ${r} (${d}) with prompt: ${j?.slice(0,50)}...`);let R=g().readFileSync(_),I=await (0,u.Vc)(y,R,j||"");if(!I)throw Error("AI Generation failed (returned null)");return g().writeFileSync(b,I),s.NextResponse.json({success:!0})}catch(e){return console.error("Regen error:",e),s.NextResponse.json({error:e.message},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/regenerate/route",pathname:"/api/admin/regenerate",filename:"route",bundlePath:"app/api/admin/regenerate/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/admin/regenerate/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:y}=h,w="/api/admin/regenerate/route";function _(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:x})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[9276,5972,9498,2723,1258,4670],()=>t(63432));module.exports=i})();