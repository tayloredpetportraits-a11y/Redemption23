"use strict";(()=>{var e={};e.id=4124,e.ids=[4124],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},16092:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{POST:()=>d});var i=t(49303),a=t(88716),s=t(60670),n=t(87070),p=t(65655),u=t(20471);async function d(e){try{let{orderId:r}=await e.json(),t=(0,p.i)(),{data:o}=await t.from("orders").select("customer_email, customer_name").eq("id",r).single();if(!o)throw Error("Order not found");return await (0,u.l)(o.customer_email,o.customer_name,r,"ready"),n.NextResponse.json({success:!0})}catch(e){return n.NextResponse.json({error:e.message},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/notify-ready/route",pathname:"/api/admin/notify-ready",filename:"route",bundlePath:"app/api/admin/notify-ready/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/admin/notify-ready/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:y}=l,h="/api/admin/notify-ready/route";function x(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},20471:(e,r,t)=>{t.d(r,{l:()=>i});var o=t(2723);async function i(e,r,t,i="ready",a){if(!process.env.RESEND_API_KEY)return console.warn("⚠️ RESEND_API_KEY missing. Skipping email send."),!1;let s=new o.R(process.env.RESEND_API_KEY),n=process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000",p=`${n}/customer/gallery/${t}`;console.log(`[Email Service] Sending '${i}' notification to ${e}...`);let u="Your Pet Portraits are Ready! \uD83D\uDC3E",d="";"ordered"===i?(u="We’ve started your Pet Portrait! \uD83C\uDFA8",d=`
            <h1 style="color: #d97706;">We're on it!</h1>
            <p>Hi ${r},</p>
            <p>Thanks for your order! We've received your photos and our AI artists are hard at work creating your custom portraits.</p>
            <p>This usually takes 10-20 minutes. We'll send you another email as soon as they are ready for review.</p>
            <p style="margin-top: 20px;">Sit tight!</p>
        `):d=`
          <h1 style="color: #d97706;">Your Portraits are Here!</h1>
          <p>Hi ${r},</p>
          <p>We've finished working on your pet's portraits and they look amazing!</p>
          ${a?`<img src="${n}${a}" alt="Preview" style="width: 100%; max-width: 300px; border-radius: 8px; margin: 20px 0;" />`:""}
          <p>Click the button below to view your gallery, unlock your favorites, and share with friends.</p>
          <a href="${p}" style="display: inline-block; background-color: #d97706; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; margin-top: 10px;">View My Gallery</a>
          <p style="margin-top: 30px; font-size: 12px; color: #888;">
            If the button doesn't work, copy this link:<br>
            <a href="${p}">${p}</a>
          </p>
        `;try{let{data:r,error:t}=await s.emails.send({from:"Pet Portraits <onboarding@resend.dev>",to:[e],subject:u,html:`
        <div style="font-family: sans-serif; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
          ${d}
        </div>
      `});if(t)return console.error("[Email Service] Error:",t),!1;return console.log("[Email Service] Email sent successfully:",r?.id),!0}catch(e){return console.error("[Email Service] Exception:",e),!1}}},65655:(e,r,t)=>{t.d(r,{i:()=>i});var o=t(69498);function i(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,o.eI)("https://opxgicxdrbpgpsxonogk.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1},global:{fetch:(e,r)=>fetch(e,{...r,cache:"no-store"})}})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,2723],()=>t(16092));module.exports=o})();