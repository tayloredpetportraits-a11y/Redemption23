"use strict";(()=>{var e={};e.id=3517,e.ids=[3517],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},46134:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>y,staticGenerationAsyncStorage:()=>k});var o={};t.r(o),t.d(o,{POST:()=>h,maxDuration:()=>x});var s=t(49303),a=t(88716),n=t(60670),i=t(87070),p=t(94670),u=t(65655),c=t(92048),d=t.n(c),l=t(55315),m=t.n(l);let x=300;async function h(e){try{let{orderId:r,portraitUrl:t,portraitId:o}=await e.json();if(!r||!t||!o)return i.NextResponse.json({error:"Missing parameters"},{status:400});let s=(0,u.i)(),a=m().join(process.cwd(),"public","mockup-templates"),n=[];d().existsSync(a)&&(n=d().readdirSync(a).filter(e=>d().statSync(m().join(a,e)).isDirectory())),["canvas-11x14","bear","tumbler"].forEach(e=>{n.includes(e)||n.push(e)});let c=t.startsWith("/")?t.slice(1):t,l=m().join(process.cwd(),"public",c);if(!d().existsSync(l))return i.NextResponse.json({error:"Source image not found"},{status:404});let x=m().join(process.cwd(),"public","generated",r,"mockups");d().existsSync(x)||d().mkdirSync(x,{recursive:!0});let h=[];for(let e of n){let t=`mockup_${e}_${o}_${Date.now()}.png`,s=m().join(x,t),a=`/generated/${r}/mockups/${t}`;if(console.log(`[Admin] Generating Mockup: ${e} for ${o}`),await (0,p.$y)(l,e,s)){let s={order_id:r,url:a,storage_path:`generated/${r}/mockups/${t}`,type:"mockup",status:"approved",metadata:{linked_portrait_id:o,product_type:e},display_order:100};h.push(s)}}if(!(h.length>0))return i.NextResponse.json({error:"Generation failed for all items"},{status:500});{let{error:e}=await s.from("images").insert(h);if(e)throw e;return i.NextResponse.json({success:!0,count:h.length})}}catch(e){return console.error("Batch Mockup Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/generate-mockup-batch/route",pathname:"/api/admin/generate-mockup-batch",filename:"route",bundlePath:"app/api/admin/generate-mockup-batch/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/admin/generate-mockup-batch/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:k,serverHooks:y}=g,j="/api/admin/generate-mockup-batch/route";function q(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:k})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,2723,1258,4670],()=>t(46134));module.exports=o})();