"use strict";(()=>{var e={};e.id=4543,e.ids=[4543],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},57781:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>k,patchFetch:()=>q,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>$,staticGenerationAsyncStorage:()=>w});var a={};t.r(a),t.d(a,{POST:()=>_,dynamic:()=>x,maxDuration:()=>f});var o=t(49303),s=t(88716),i=t(60670),n=t(87070),p=t(65655),d=t(94670),c=t(81665),l=t(79777),u=t(92048),m=t.n(u),g=t(55315),h=t.n(g);let f=300,x="force-dynamic";async function _(e,{params:r}){try{let{imageId:e}=r,t=(0,p.i)(),{data:a,error:o}=await t.from("images").select("*, orders(*)").eq("id",e).single();if(o||!a)return n.NextResponse.json({error:"Image not found"},{status:404});let s=a.orders,{error:i}=await t.from("images").update({status:"approved"}).eq("id",e);if(i)return n.NextResponse.json({error:"Failed to update status"},{status:500});if(s&&s.social_consent){console.log(`[Social] Generating draft for Order ${s.id}`);try{let{caption:e,hashtags:r}=await (0,c.x)(s.pet_name||"Pet",s.pet_breed||"",s.product_type||"Portrait",s.pet_details||"");await (0,l.YR)({order_id:s.id,image_id:a.id,caption:e,hashtags:r,platform:"instagram"}),console.log(`[Social] Draft created for ${s.id}`)}catch(e){console.error("[Social] Failed to generate draft:",e)}}let u=h().join(process.cwd(),"public","generated",a.order_id,"mockups");m().existsSync(u)||m().mkdirSync(u,{recursive:!0});let g=a.url.startsWith("/")?a.url.slice(1):a.url,f=h().join(process.cwd(),"public",g);if(!m().existsSync(f))return console.error("Original file missing, cannot mock:",f),n.NextResponse.json({success:!0,warning:"Source file missing for mockups"});let x=[];for(let r of(console.log(`[Auto-Mockup] Starting batch for ${e}`),["canvas-11x14","bear","tumbler"])){let t=`mockup_${r}_${e}_${Date.now()}.png`,o=h().join(u,t),s=`/generated/${a.order_id}/mockups/${t}`;try{await (0,d.$y)(f,r,o)&&x.push({order_id:a.order_id,url:s,storage_path:`generated/${a.order_id}/mockups/${t}`,type:"upsell",is_bonus:!1,status:"approved",template_id:e,theme_name:r,display_order:100})}catch(e){console.error(`Failed to generate ${r}:`,e)}}if(x.length>0){let{error:e}=await t.from("images").insert(x);if(e)return console.error("Failed to insert mockups:",e),n.NextResponse.json({error:"Failed to save mockups",details:e},{status:500});console.log(`[Auto-Mockup] Created ${x.length} variants`)}return n.NextResponse.json({success:!0,mockupsCreated:x.length})}catch(e){return console.error("Approve Endpoint Error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/images/[imageId]/approve/route",pathname:"/api/admin/images/[imageId]/approve",filename:"route",bundlePath:"app/api/admin/images/[imageId]/approve/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/admin/images/[imageId]/approve/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:$}=y,k="/api/admin/images/[imageId]/approve/route";function q(){return(0,i.patchFetch)({serverHooks:$,staticGenerationAsyncStorage:w})}},81665:(e,r,t)=>{t.d(r,{x:()=>o});let a=new(t(11258)).$D(process.env.GOOGLE_AI_API_KEY);async function o(e,r,t,o=""){try{let s=a.getGenerativeModel({model:"gemini-1.5-flash"}),i=`
        You remain in the persona of a professional social media manager for "Taylored Pet Portraits", a brand that turns pets into royalty, astronauts, and more.
        
        Task: Write an engaging Instagram caption for a new customer portrait.
        
        Details:
        - Pet Name: ${e}
        - Breed: ${r||"Adorable Pet"}
        - Theme/Product: ${t}
        - Extra Details: ${o}
        
        Requirements:
        1. Tone: Fun, celebratory, slightly humorous, and premium.
        2. Format: Returns a JSON object with 'caption' (string) and 'hashtags' (string[]).
        3. Caption: 1-2 sentences. Use emojis. Encourage people to get their own at the link in bio.
        4. Hashtags: 10-15 relevant tags mixed with high volume (e.g. #dogsofinstagram) and niche (e.g. #custompetportrait).
        
        Output JSON only.
        `,n=(await s.generateContent(i)).response.text().replace(/```json/g,"").replace(/```/g,"").trim(),p=JSON.parse(n);return{caption:p.caption||`All hail King ${e}! ðŸ‘‘ Another masterpiece by Taylored Pet Portraits.`,hashtags:p.hashtags||["#petportraits","#dogsofinstagram"]}}catch(t){return console.error("AI Caption Generation Failed:",t),{caption:`${e} is looking majestic! ðŸ¾ Get your own custom pet portrait today!`,hashtags:["#petportraits","#customart",`#${r.replace(/\s/g,"")}`]}}}},79777:(e,r,t)=>{t.d(r,{GC:()=>s,YR:()=>o});var a=t(65655);async function o(e){let r=(0,a.i)(),{data:t,error:o}=await r.from("social_posts").insert({order_id:e.order_id,image_id:e.image_id,caption:e.caption,hashtags:e.hashtags,platform:e.platform||"instagram",status:"draft"}).select().single();if(o)throw o;return t}async function s(e="draft"){let r=(0,a.i)().from("social_posts").select(`
            *,
            images (
                url,
                storage_path
            ),
            orders (
                customer_name,
                pet_name
            )
        `).order("created_at",{ascending:!1});"all"!==e&&(r=r.eq("status",e));let{data:t,error:o}=await r;if(o)throw o;return t}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972,9498,2723,1258,4670],()=>t(57781));module.exports=a})();