"use strict";(()=>{var e={};e.id=8501,e.ids=[8501],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57441:e=>{e.exports=require("sharp")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},26822:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>k});var o={};t.r(o),t.d(o,{POST:()=>f});var a=t(49303),s=t(88716),i=t(60670),n=t(87070),u=t(94670),p=t(65655),c=t(55315),m=t.n(c),l=t(92048),d=t.n(l),g=t(2390);async function f(e){try{let r=await e.formData(),t=r.get("template"),o=r.get("orderId"),a=r.get("portraitId"),s=r.get("portraitUrl");if(!t||!o||!a||!s)return n.NextResponse.json({error:"Missing required fields"},{status:400});let i=(0,p.i)(),c=Buffer.from(await t.arrayBuffer()),l=`custom_template_${Date.now()}_${t.name.replace(/[^a-zA-Z0-9.]/g,"")}`,f=m().join(process.cwd(),"public","temp",l),x=m().dirname(f);d().existsSync(x)||d().mkdirSync(x,{recursive:!0}),d().writeFileSync(f,c),console.log(`[CustomMockup] Fetching portrait from ${s}`);let h=await fetch(s);if(!h.ok)throw Error("Failed to fetch portrait");let k=Buffer.from(await h.arrayBuffer()),y=Date.now(),w=`mockup_custom_${a}_${y}.png`,q=m().join(process.cwd(),"public","generated",o,"mockups");d().existsSync(q)||d().mkdirSync(q,{recursive:!0});let _=m().join(q,w);console.log(`[CustomMockup] Generating using template: ${f}`);let v=await (0,u.$y)(k,"custom",_,f);try{d().unlinkSync(f)}catch(e){console.error("Failed to delete temp template",e)}if(!v)return n.NextResponse.json({error:"Generation failed"},{status:500});{let e=`generated/${o}/mockups/${w}`;await (0,g.uploadFile)(e,v);let r=(0,g.getPublicUrl)(e),{error:s}=await i.from("images").insert({order_id:o,url:r,storage_path:e,type:"mockup",status:"approved",metadata:{linked_portrait_id:a,custom_template_name:t.name},display_order:100});if(s)throw s;return n.NextResponse.json({success:!0,url:r})}}catch(e){return console.error("Custom Mockup API Error:",e),n.NextResponse.json({error:e.message||"Internal Error"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/generate-mockup-custom/route",pathname:"/api/admin/generate-mockup-custom",filename:"route",bundlePath:"app/api/admin/generate-mockup-custom/route"},resolvedPagePath:"/Users/taylorstrong/Redemption23-1/project/src/app/api/admin/generate-mockup-custom/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:k,serverHooks:y}=x,w="/api/admin/generate-mockup-custom/route";function q(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:k})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,9498,2723,1258,4670],()=>t(26822));module.exports=o})();